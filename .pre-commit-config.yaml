# .pre-commit-config.yaml
minimum_pre_commit_version: "4.3.0"

repos:
  # --- Rust: rustfmt on staged Rust files ---
  - repo: local
    hooks:
      - id: rustfmt
        name: rustfmt (Rust)
        entry: rustfmt --edition 2024
        language: system
        types: [rust]
        require_serial: true

  # --- Prettier: Astro / YAML / JSON / JSONC / (optionally) CSS ---
  # Use your project's devDependencies (prettier + plugins) via npx.
  - repo: local
    hooks:
      - id: prettier
        name: prettier (Astro/YAML/JSON/JSONC/etc.)
        entry: bash -lc 'npx prettier --ignore-unknown --write "$@"'
        language: system
        pass_filenames: true
        files: \.(astro|ya?ml|json|jsonc|css|scss|js|jsx|ts|tsx)$

  # --- Markdown: markdownlint-cli with auto-fix ---
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.45.0
    hooks:
      - id: markdownlint-fix
        name: markdownlint-fix
        description: "Fixes the style of Markdown/Commonmark files."
        entry: markdownlint --fix
        language: node
        types: [markdown]
        minimum_pre_commit_version: 0.15.0

  # --- TOML: Taplo formatter ---
  - repo: https://github.com/ComPWA/taplo-pre-commit
    rev: v0.9.3
    hooks:
      - id: taplo-lint
        name: taplo lint (TOML)
      - id: taplo-format
        name: taplo format (TOML)

  # --- SQL Linting & Formatting (Postgres) ---
  - repo: https://github.com/sqlfluff/sqlfluff
    rev: 3.4.2 # check for the latest release tag
    hooks:
      - id: sqlfluff-lint
        name: sqlfluff lint (Postgres)
        entry: sqlfluff lint --dialect postgres
        language: python
        types: [sql]
      - id: sqlfluff-fix
        name: sqlfluff fix (Postgres)
        entry: sqlfluff fix --dialect postgres
        language: python
        types: [sql]
