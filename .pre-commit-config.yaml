# .pre-commit-config.yaml
minimum_pre_commit_version: 4.3.0
repos:
  # --- Rust: rustfmt on staged Rust files ---
  - repo: local
    hooks:
      - id: rustfmt
        name: rustfmt (Rust)
        entry: rustfmt --edition 2024
        language: system
        types:
          - rust
        require_serial: true
      - id: clippy
        name: clippy (Rust)
        entry: bash -c 'RUSTFLAGS="-Dwarnings" cargo clippy --all-targets --all-features'
        language: system
        types:
          - rust
        pass_filenames: false

  # --- Prettier: Astro / YAML / JSON / JSONC / (optionally) CSS ---
  - repo: local
    hooks:
      - id: prettier
        name: prettier (Astro/JSON/JSONC/etc.)
        entry: pnpm exec prettier --ignore-unknown --write
        language: node
        pass_filenames: true
        files: \.(astro|json|jsonc|css|scss|js|jsx|ts|tsx)$
        additional_dependencies:
          - prettier@3.6.2
          - prettier-plugin-astro@0.14.1

  # --- Markdown: markdownlint-cli with auto-fix ---
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.46.0
    hooks:
      - id: markdownlint-fix
        name: markdownlint-fix
        description: Fixes the style of Markdown/Commonmark files.
        entry: markdownlint --fix
        language: node
        types:
          - markdown
        minimum_pre_commit_version: 0.15.0

  # --- TOML: Taplo formatter ---
  - repo: https://github.com/ComPWA/taplo-pre-commit
    rev: v0.9.3
    hooks:
      - id: taplo-lint
        name: taplo lint (TOML)
      - id: taplo-format
        name: taplo format (TOML)

  # --- SQL Linting & Formatting (Postgres) ---
  - repo: https://github.com/sqlfluff/sqlfluff
    rev: 4.0.0a2
    hooks:
      - id: sqlfluff-lint
        name: sqlfluff lint (Postgres)
        entry: sqlfluff lint --dialect postgres
        language: python
        types:
          - sql
      - id: sqlfluff-fix
        name: sqlfluff fix (Postgres)
        entry: sqlfluff fix --dialect postgres
        language: python
        types:
          - sql

  # --- YAML Formatting ---
  - repo: https://github.com/lyz-code/yamlfix
    rev: 1.19.0
    hooks:
      - id: yamlfix
        exclude: .*lock\.ya?ml$
